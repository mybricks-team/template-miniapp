/*! For license information please see mybricks_taro_systemLogin.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@tarojs/components"),require("@tarojs/taro"),require("react")):"function"==typeof define&&define.amd?define(["@tarojs/components","@tarojs/taro","react"],e):"object"==typeof exports?exports.fangzhouComDef=e(require("@tarojs/components"),require("@tarojs/taro"),require("react")):t.fangzhouComDef=e(t["@tarojs/components"],t["@tarojs/taro"],t.React)}(self,((t,e,o)=>(()=>{var n={447:(t,e,o)=>{"use strict";function n(t){var e;return!(!(null==t?void 0:t.edit)&&!(null===(e=null==t?void 0:t.runtime)||void 0===e?void 0:e.debug))}o.d(e,{l:()=>n})},3078:(t,e,o)=>{var n;function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}!function(){"use strict";var i={}.hasOwnProperty;function a(){for(var t=[],e=0;e<arguments.length;e++){var o=arguments[e];if(o){var n=r(o);if("string"===n||"number"===n)t.push(o);else if(Array.isArray(o)){if(o.length){var u=a.apply(null,o);u&&t.push(u)}}else if("object"===n){if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]")){t.push(o.toString());continue}for(var c in o)i.call(o,c)&&o[c]&&t.push(c)}}}return t.join(" ")}t.exports?(a.default=a,t.exports=a):"object"===r(o.amdO)&&o.amdO?void 0===(n=function(){return a}.apply(e,[]))||(t.exports=n):window.classNames=a}()},539:(t,e,o)=>{"use strict";o.d(e,{Z:()=>n});const n={login:"login-ebb56",edit:"edit-d3c9d",logo:"logo-a7647",button:"button-fbe5c",exit:"exit-eba12"}},9525:e=>{"use strict";e.exports=t},6801:t=>{"use strict";t.exports=e},359:t=>{"use strict";t.exports=o}},r={};function i(t){var e=r[t];if(void 0!==e)return e.exports;var o=r[t]={exports:{}};return n[t](o,o.exports,i),o.exports}i.amdO={},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{"use strict";i.r(a),i.d(a,{default:()=>d});var t=i(359),e=i.n(t),o=i(9525),n=i(539),r=i(3078),u=i.n(r),c=i(6801),s=i(447),l=function(){return l=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},l.apply(this,arguments)};function d(r){var i,a,d=r.env,f=r.data,p=(r.inputs,r.outputs,r.slots,c.getApp()),m=(0,t.useState)(null===(a=null==p?void 0:p.mybricks)||void 0===a?void 0:a.status)[0],v=(0,t.useCallback)((function(t){return new Promise((function(e,o){c.request({url:"".concat(m.callServiceHost,"/runtime/api/auth/register"),method:"POST",data:{projectId:m.projectId,username:t,password:t},success:function(t){var n;1===(null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.code)?(c.setStorageSync("userInfo",t.data.data),c.showToast({title:"登录成功",icon:"none",duration:1e3}),setTimeout((function(){c.navigateBack({delta:1})}),1e3),e(t.data.data)):o()}})}))}),[m]),b=(0,t.useCallback)((function(t){return new Promise((function(e,o){c.request({url:"".concat(m.callServiceHost,"/runtime/api/auth/login"),method:"POST",data:{projectId:m.projectId,username:t,password:t},success:function(t){var n;1===(null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.code)?(c.setStorageSync("userInfo",t.data.data),c.showToast({title:"登录成功",icon:"none",duration:1e3}),setTimeout((function(){c.navigateBack({delta:1})}),1e3),e(t.data.data)):o()}})}))}),[m]),y=(0,t.useCallback)((function(){return new Promise((function(t,e){c.login({success:function(o){var n="".concat(null==m?void 0:m.callServiceHost,"/runtime/api/domain/service/run");c.request({url:n,method:"POST",data:{projectId:null==m?void 0:m.appid,fileId:null==m?void 0:m.appid,serviceId:"jscode2session",params:{code:o.code}},success:function(e){t(e.data.data.openid)},fail:function(){e()}})},fail:function(){e()}})}))}),[m]),g=!1,h=(0,t.useCallback)((function(){d.runtime&&((null==d?void 0:d.runtime.debug)||y().then((function(t){b(t).then((function(){})).catch((function(){v(t).then((function(){})).catch((function(){c.showToast({title:"登录失败，请重试",icon:"none",duration:1e3})}))}))})).catch((function(){c.showToast({title:"登录失败，请重试",icon:"none",duration:1e3})})))}),[d.runtime]),j=(0,t.useCallback)((function(){c.navigateBack({delta:1})}),[]);return e().createElement(o.View,{className:u()(n.Z.login,(i={},i[n.Z.edit]=(0,s.l)(d),i))},f.useLogo&&f.logo?e().createElement(o.Image,{className:u()(n.Z.logo,"mybricks-logo"),style:l({},f.logoStyle),mode:"widthFix",src:f.logo}):null,e().createElement(o.View,{className:u()(n.Z.button,"mybricks-button"),onClick:function(){g||(g=setTimeout((function(){h(),g=!1}),1e3))}},"一键登录"),e().createElement(o.View,{className:u()(n.Z.exit,"mybricks-exit"),onClick:j},"暂不登录"))}})(),a})()));