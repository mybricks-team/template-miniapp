/*! For license information please see mybricks_taro_formImageUploader.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@tarojs/components"),require("@tarojs/taro"),require("react")):"function"==typeof define&&define.amd?define(["@tarojs/components","@tarojs/taro","react"],t):"object"==typeof exports?exports.fangzhouComDef=t(require("@tarojs/components"),require("@tarojs/taro"),require("react")):e.fangzhouComDef=t(e["@tarojs/components"],e["@tarojs/taro"],e.React)}(self,((e,t,r)=>(()=>{var n={7234:(e,t,r)=>{"use strict";function n(e){return(t="Object",function(e){return Object.prototype.toString.call(e)==="[object ".concat(t,"]")})(e);var t}r.d(t,{Kn:()=>n})},447:(e,t,r)=>{"use strict";function n(e){var t;return!(!(null==e?void 0:e.edit)&&!(null===(t=null==e?void 0:e.runtime)||void 0===t?void 0:t.debug))}r.d(t,{l:()=>n})},3078:(e,t,r)=>{var n;function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}!function(){"use strict";var a={}.hasOwnProperty;function u(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var n=o(r);if("string"===n||"number"===n)e.push(r);else if(Array.isArray(r)){if(r.length){var l=u.apply(null,r);l&&e.push(l)}}else if("object"===n){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){e.push(r.toString());continue}for(var c in r)a.call(r,c)&&r[c]&&e.push(c)}}}return e.join(" ")}e.exports?(u.default=u,e.exports=u):"object"===o(r.amdO)&&r.amdO?void 0===(n=function(){return u}.apply(t,[]))||(e.exports=n):window.classNames=u}()},2810:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});const n={value:"value-bc707",uploader:"uploader-e5cb1",chooseAvatar:"chooseAvatar-cc239",item:"item-c8e62",thumbnail:"thumbnail-baad0",remove:"remove-ffe84",placeholder:"placeholder-b6ca9",text:"text-c5e7b",placeholderText:"placeholderText-b560d"}},9525:t=>{"use strict";t.exports=e},6801:e=>{"use strict";e.exports=t},359:e=>{"use strict";e.exports=r}},o={};function a(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return n[e](r,r.exports,a),r.exports}a.amdO={},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{"use strict";a.r(u),a.d(u,{default:()=>m});var e=a(359),t=a.n(e),r=a(9525),n=a(2810),o=a(3078),l=a.n(o),c=a(6801),i=a(7234),s=a(447),f=function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function u(e){try{c(n.next(e))}catch(e){a(e)}}function l(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,l)}c((n=n.apply(e,t||[])).next())}))},p=function(e,t){var r,n,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(c){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(u=0)),u;)try{if(r=1,n&&(o=2&l[0]?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return u.label++,{value:l[1],done:!1};case 5:u.label++,n=l[1],l=[0];continue;case 7:l=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){u=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){u.label=l[1];break}if(6===l[0]&&u.label<o[1]){u.label=o[1],o=l;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(l);break}o[2]&&u.ops.pop(),u.trys.pop();continue}l=t.call(e,u)}catch(e){l=[6,e],n=0}finally{r=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}};function m(o){var a=this,u=o.env,m=o.data,v=o.inputs,d=o.outputs,b=(o.slots,o.parentSlot);(0,e.useEffect)((function(){v.setValue((function(e){switch(!0){case"string"==typeof e:m.value=[e].filter((function(e){return!!e}));break;case Array.isArray(e):m.value=e;break;case(0,i.Kn)(e):var t=e[m.name];"string"==typeof t?m.value=[e[m.name]].filter((function(e){return!!e})):Array.isArray(t)&&(m.value=e[m.name])}}))}),[]);var h=(0,e.useCallback)((function(e){var t,r,n=e;1==m.maxCount&&m.useValueString&&(n=e[0]||""),null===(r=null==b?void 0:(t=b._inputs).onChange)||void 0===r||r.call(t,{id:o.id,name:o.name,value:n}),d.onChange(n)}),[m.name,m.maxCount,m.useValueString]),y=(0,e.useCallback)((function(e,t){e.stopPropagation(),c.previewImage({urls:[t]})}),[]),g=(0,e.useCallback)((function(e,t){e.stopPropagation();var r=m.value.filter((function(e,r){return r!==t}));m.value=r,h(r)}),[m.value]),x=(0,e.useCallback)((function(){c.chooseImage({count:m.maxCount-m.value.length,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){return f(a,void 0,void 0,(function(){return p(this,(function(t){return u.fileUploader(e.tempFiles[0]).then((function(e){var t=JSON.parse(JSON.stringify(m.value));t.unshift(e),m.value=t,h(t)})),[2]}))}))}})}),[m.value]),S=(0,e.useCallback)((function(e){console.error(e);var t=e.detail.avatarUrl;u.fileUploader({path:t}).then((function(e){var t=JSON.parse(JSON.stringify(m.value));t.unshift(e),m.value=t,h(t)}))}),[m.value]),w=(0,e.useMemo)((function(){return m.value.length>=m.maxCount?null:m.chooseAvatar&&!(0,s.l)(u)?t().createElement(r.View,{className:l()(n.Z.uploader,"mybricks-square")},t().createElement(r.Button,{className:n.Z.chooseAvatar,openType:"chooseAvatar",onChooseAvatar:S})):t().createElement(r.View,{className:l()(n.Z.uploader,"mybricks-square"),onClick:x})}),[u,m.value,m.maxCount,m.chooseAvatar]),j=(0,e.useMemo)((function(){return m.value.map((function(e,o){return t().createElement(r.View,{className:l()(n.Z.item,"mybricks-square"),onClick:function(t){y(t,e)}},t().createElement(r.Image,{className:n.Z.thumbnail,mode:"aspectFill",src:e}),t().createElement(r.View,{className:n.Z.remove,onClick:function(e){g(e,o)}}))}))}),[m.value]),k=(0,e.useMemo)((function(){return m.placeholder?t().createElement(r.View,{className:l()(n.Z.placeholder,"mybricks-square"),onClick:function(e){y(e,m.placeholder)}},t().createElement(r.Image,{className:n.Z.thumbnail,mode:"aspectFill",src:m.placeholder}),t().createElement(r.View,{className:n.Z.text},"示例图片")):null}),[m.placeholder]),C=(0,e.useMemo)((function(){return m.placeholderText?t().createElement(r.View,{className:n.Z.placeholderText},m.placeholderText):null}),[m.placeholderText]);return t().createElement(r.View,{className:n.Z.value},w,j,C,k)}})(),u})()));